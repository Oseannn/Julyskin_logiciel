(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[680],{4169:function(e,r,t){Promise.resolve().then(t.bind(t,2113))},9061:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(8204).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},2113:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return g}});var s=t(7437),n=t(2265),a=t(6463),i=t(1828),l=t(9733),o=t(8185),c=t(7209),d=t(402),u=t(9055),f=t(7304);let m=(0,t(8204).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);var x=t(9061),h=t(2800),p=t(8320);function g(){let e=(0,a.useRouter)(),{user:r}=(0,p.t)(),[t,g]=(0,n.useState)([]),[b,v]=(0,n.useState)([]),[j,N]=(0,n.useState)([]),[y,w]=(0,n.useState)(""),[k,C]=(0,n.useState)([]),[Z,R]=(0,n.useState)(20),[S,T]=(0,n.useState)("");(0,n.useEffect)(()=>{Promise.all([h.Z.get("/clients"),h.Z.get("/products"),h.Z.get("/services"),h.Z.get("/settings")]).then(e=>{let[r,t,s,n]=e;g(r.data),v(t.data),N(s.data),n.data.length>0&&R(n.data[0].defaultTaxRate)})},[]);let P=e=>{let r=b.find(r=>r.id===e);r&&C([...k,{type:"PRODUCT",productId:r.id,name:r.name,quantity:1,unitPrice:r.sellingPrice}])},A=e=>{let r=j.find(r=>r.id===e);r&&C([...k,{type:"SERVICE",serviceId:r.id,name:r.name,duration:r.minDuration||60,unitPrice:r.unitPrice,billingType:r.billingType}])},I=e=>{C(k.filter((r,t)=>t!==e))},z=(e,r,t)=>{let s=[...k];s[e][r]=t,C(s)},F=e=>"PRODUCT"===e.type?e.quantity*e.unitPrice:"PAR_MINUTE"===e.billingType?Math.round(e.duration*e.unitPrice):"PAR_HEURE"===e.billingType?Math.round(e.duration/60*e.unitPrice):e.unitPrice,M=k.reduce((e,r)=>e+F(r),0),O=Math.round(M*Z/100),_=async()=>{if(!y){alert("Veuillez s\xe9lectionner un client");return}if(0===k.length){alert("Veuillez ajouter au moins un article");return}try{let t={clientId:y,userId:null==r?void 0:r.id,taxRate:Z,notes:S,lines:k.map(e=>({type:e.type,productId:e.productId,serviceId:e.serviceId,name:e.name,quantity:e.quantity,duration:e.duration,unitPrice:e.unitPrice,total:F(e)}))};await h.Z.post("/invoices",t),e.push("/dashboard/invoices")}catch(e){var t,s;alert((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Erreur lors de la cr\xe9ation de la facture")}};return(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Nouvelle facture"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:"Cr\xe9ez une nouvelle facture pour un client"})]}),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)(o.Zb,{children:[(0,s.jsxs)(o.Ol,{children:[(0,s.jsx)(o.ll,{children:"Client"}),(0,s.jsx)(o.SZ,{children:"S\xe9lectionnez le client pour cette facture"})]}),(0,s.jsx)(o.aY,{children:(0,s.jsxs)("select",{value:y,onChange:e=>w(e.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",required:!0,children:[(0,s.jsx)("option",{value:"",children:"S\xe9lectionner un client"}),t.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName," - ",e.phone]},e.id))]})})]}),(0,s.jsxs)(o.Zb,{children:[(0,s.jsxs)(o.Ol,{children:[(0,s.jsx)(o.ll,{children:"Ajouter des articles"}),(0,s.jsx)(o.SZ,{children:"Ajoutez des produits ou services \xe0 la facture"})]}),(0,s.jsx)(o.aY,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d._,{children:"Ajouter un produit"}),(0,s.jsxs)("select",{onChange:e=>{e.target.value&&(P(e.target.value),e.target.value="")},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[(0,s.jsx)("option",{value:"",children:"S\xe9lectionner un produit"}),b.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," - ",e.sellingPrice," FCFA"]},e.id))]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d._,{children:"Ajouter un service"}),(0,s.jsxs)("select",{onChange:e=>{e.target.value&&(A(e.target.value),e.target.value="")},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[(0,s.jsx)("option",{value:"",children:"S\xe9lectionner un service"}),j.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," - ",e.unitPrice," FCFA"]},e.id))]})]})]})})]}),(0,s.jsxs)(o.Zb,{children:[(0,s.jsx)(o.Ol,{children:(0,s.jsx)(o.ll,{children:"Articles"})}),(0,s.jsx)(o.aY,{children:(0,s.jsxs)(f.iA,{children:[(0,s.jsx)(f.xD,{children:(0,s.jsxs)(f.SC,{children:[(0,s.jsx)(f.ss,{children:"Article"}),(0,s.jsx)(f.ss,{children:"Qt\xe9/Dur\xe9e"}),(0,s.jsx)(f.ss,{children:"Prix unitaire"}),(0,s.jsx)(f.ss,{children:"Total"}),(0,s.jsx)(f.ss,{})]})}),(0,s.jsx)(f.RM,{children:0===k.length?(0,s.jsx)(f.SC,{children:(0,s.jsx)(f.pj,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Aucun article ajout\xe9"})}):k.map((e,r)=>{let t=F(e);return(0,s.jsxs)(f.SC,{children:[(0,s.jsx)(f.pj,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.name}),(0,s.jsx)(u.C,{variant:"outline",className:"mt-1",children:"PRODUCT"===e.type?"Produit":"Service"})]})}),(0,s.jsx)(f.pj,{children:"PRODUCT"===e.type?(0,s.jsx)(c.I,{type:"number",min:"1",value:e.quantity,onChange:e=>z(r,"quantity",parseInt(e.target.value)),className:"w-20"}):(0,s.jsx)(c.I,{type:"number",min:"1",value:e.duration,onChange:e=>z(r,"duration",parseInt(e.target.value)),className:"w-20"})}),(0,s.jsxs)(f.pj,{children:[e.unitPrice," FCFA"]}),(0,s.jsxs)(f.pj,{className:"font-medium",children:[t," FCFA"]}),(0,s.jsx)(f.pj,{children:(0,s.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>I(r),children:(0,s.jsx)(m,{className:"h-4 w-4 text-destructive"})})})]},r)})})]})})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(o.Zb,{children:[(0,s.jsx)(o.Ol,{children:(0,s.jsx)(o.ll,{children:"R\xe9sum\xe9"})}),(0,s.jsxs)(o.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Sous-total HT"}),(0,s.jsxs)("span",{className:"font-medium",children:[M," FCFA"]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsxs)("span",{className:"text-muted-foreground",children:["TVA (",Z,"%)"]}),(0,s.jsxs)("span",{className:"font-medium",children:[O," FCFA"]})]}),(0,s.jsx)("div",{className:"border-t pt-4",children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Total TTC"}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-primary",children:[M+O," FCFA"]})]})})]})]}),(0,s.jsxs)(o.Zb,{children:[(0,s.jsx)(o.Ol,{children:(0,s.jsx)(o.ll,{children:"Notes"})}),(0,s.jsx)(o.aY,{children:(0,s.jsx)("textarea",{value:S,onChange:e=>T(e.target.value),placeholder:"Notes additionnelles...",className:"flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})})]}),(0,s.jsxs)(l.z,{onClick:_,className:"w-full",size:"lg",children:[(0,s.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"Cr\xe9er la facture"]})]})]})]})})}},1828:function(e,r,t){"use strict";t.d(r,{Z:function(){return N}});var s=t(7437),n=t(2265),a=t(6463),i=t(7138),l=t(8320),o=t(2800),c=t(9733),d=t(7140),u=t(2023),f=t(7524),m=t(5912),x=t(1240),h=t(8062),p=t(4258),g=t(4697),b=t(2873),v=t(9896),j=t(9354);function N(e){let{children:r}=e,t=(0,a.useRouter)(),N=(0,a.usePathname)(),{user:y,setUser:w,logout:k}=(0,l.t)(),[C,Z]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(!localStorage.getItem("accessToken")){t.push("/login");return}y||o.Z.get("/users").then(()=>{let e=localStorage.getItem("user");e&&w(JSON.parse(e))}).catch(()=>{t.push("/login")})},[y,w,t]);let R=[{href:"/dashboard",label:"Tableau de bord",icon:d.Z},{href:"/dashboard/invoices",label:"Factures",icon:u.Z},{href:"/dashboard/products",label:"Produits",icon:f.Z},{href:"/dashboard/services",label:"Services",icon:m.Z},{href:"/dashboard/clients",label:"Clients",icon:x.Z},...(null==y?void 0:y.role)==="ADMIN"?[{href:"/dashboard/users",label:"Utilisateurs",icon:h.Z}]:[],{href:"/dashboard/settings",label:"Param\xe8tres",icon:p.Z}];return(0,s.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,s.jsxs)("div",{className:"md:hidden sticky top-0 z-40 flex h-16 items-center gap-4 border-b bg-background px-4",children:[(0,s.jsx)(c.z,{variant:"ghost",size:"icon",onClick:()=>Z(!C),children:C?(0,s.jsx)(g.Z,{className:"h-5 w-5"}):(0,s.jsx)(b.Z,{className:"h-5 w-5"})}),(0,s.jsx)("h1",{className:"text-lg font-semibold",children:"Julyskin"})]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("aside",{className:(0,j.cn)("fixed inset-y-0 left-0 z-50 w-64 transform border-r bg-card transition-transform duration-200 ease-in-out md:relative md:translate-x-0",C?"translate-x-0":"-translate-x-full"),children:(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsx)("div",{className:"hidden md:flex h-16 items-center border-b px-6",children:(0,s.jsx)("h1",{className:"text-xl font-bold text-primary",children:"Julyskin"})}),(0,s.jsx)("nav",{className:"flex-1 space-y-1 p-4 overflow-y-auto",children:R.map(e=>{let r=e.icon,t=N===e.href;return(0,s.jsxs)(i.default,{href:e.href,onClick:()=>Z(!1),className:(0,j.cn)("flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors",t?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-accent hover:text-accent-foreground"),children:[(0,s.jsx)(r,{className:"h-4 w-4"}),e.label]},e.href)})}),(0,s.jsxs)("div",{className:"border-t p-4",children:[y&&(0,s.jsxs)("div",{className:"mb-3 rounded-lg bg-muted p-3",children:[(0,s.jsxs)("p",{className:"text-sm font-medium",children:[y.firstName," ",y.lastName]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:y.email}),(0,s.jsx)("p",{className:"mt-1 text-xs font-medium text-primary",children:"ADMIN"===y.role?"Administrateur":"Vendeuse"})]}),(0,s.jsxs)(c.z,{variant:"outline",className:"w-full",onClick:()=>{k(),t.push("/login")},children:[(0,s.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"D\xe9connexion"]})]})]})}),C&&(0,s.jsx)("div",{className:"fixed inset-0 z-40 bg-black/50 md:hidden",onClick:()=>Z(!1)}),(0,s.jsx)("main",{className:"flex-1 overflow-auto",children:(0,s.jsx)("div",{className:"container mx-auto p-4 md:p-8",children:r})})]})]})}},9055:function(e,r,t){"use strict";t.d(r,{C:function(){return l}});var s=t(7437);t(2265);var n=t(3027),a=t(9354);let i=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-100 text-green-800",warning:"border-transparent bg-yellow-100 text-yellow-800"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...n}=e;return(0,s.jsx)("div",{className:(0,a.cn)(i({variant:t}),r),...n})}},9733:function(e,r,t){"use strict";t.d(r,{z:function(){return o}});var s=t(7437),n=t(2265),a=t(3027),i=t(9354);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef((e,r)=>{let{className:t,variant:n,size:a,...o}=e;return(0,s.jsx)("button",{className:(0,i.cn)(l({variant:n,size:a,className:t})),ref:r,...o})});o.displayName="Button"},8185:function(e,r,t){"use strict";t.d(r,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},ll:function(){return o}});var s=t(7437),n=t(2265),a=t(9354);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});i.displayName="Card";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t),...n})});l.displayName="CardHeader";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("h3",{ref:r,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});o.displayName="CardTitle";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("p",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",t),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",t),...n})});d.displayName="CardContent",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},7209:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var s=t(7437),n=t(2265),a=t(9354);let i=n.forwardRef((e,r)=>{let{className:t,type:n,...i}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})});i.displayName="Input"},402:function(e,r,t){"use strict";t.d(r,{_:function(){return i}});var s=t(7437),n=t(2265),a=t(9354);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("label",{ref:r,className:(0,a.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...n})});i.displayName="Label"},7304:function(e,r,t){"use strict";t.d(r,{RM:function(){return o},SC:function(){return c},iA:function(){return i},pj:function(){return u},ss:function(){return d},xD:function(){return l}});var s=t(7437),n=t(2265),a=t(9354);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:r,className:(0,a.cn)("w-full caption-bottom text-sm",t),...n})})});i.displayName="Table";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("thead",{ref:r,className:(0,a.cn)("[&_tr]:border-b",t),...n})});l.displayName="TableHeader";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("tbody",{ref:r,className:(0,a.cn)("[&_tr:last-child]:border-0",t),...n})});o.displayName="TableBody",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("tfoot",{ref:r,className:(0,a.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...n})}).displayName="TableFooter";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("tr",{ref:r,className:(0,a.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...n})});c.displayName="TableRow";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("th",{ref:r,className:(0,a.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...n})});d.displayName="TableHead";let u=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("td",{ref:r,className:(0,a.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...n})});u.displayName="TableCell",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("caption",{ref:r,className:(0,a.cn)("mt-4 text-sm text-muted-foreground",t),...n})}).displayName="TableCaption"},2800:function(e,r,t){"use strict";var s=t(8472);let n=s.Z.create({baseURL:"http://localhost:4000/api"});n.interceptors.request.use(e=>{let r=localStorage.getItem("accessToken");return r&&(e.headers.Authorization="Bearer ".concat(r)),e}),n.interceptors.response.use(e=>e,async e=>{var r;if((null===(r=e.response)||void 0===r?void 0:r.status)===401){let r=localStorage.getItem("refreshToken");if(r)try{let{data:t}=await s.Z.post("".concat("http://localhost:4000/api","/auth/refresh"),{refreshToken:r});return localStorage.setItem("accessToken",t.accessToken),e.config.headers.Authorization="Bearer ".concat(t.accessToken),n.request(e.config)}catch(e){localStorage.clear(),window.location.href="/login"}}return Promise.reject(e)}),r.Z=n},9354:function(e,r,t){"use strict";t.d(r,{cn:function(){return a}});var s=t(4839),n=t(6164);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.m6)((0,s.W)(r))}},8320:function(e,r,t){"use strict";t.d(r,{t:function(){return s}});let s=(0,t(9099).Ue)(e=>({user:null,setUser:r=>e({user:r}),logout:()=>{localStorage.clear(),e({user:null})}}))}},function(e){e.O(0,[100,734,971,23,744],function(){return e(e.s=4169)}),_N_E=e.O()}]);